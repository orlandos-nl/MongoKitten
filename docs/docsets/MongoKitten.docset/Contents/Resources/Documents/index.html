<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MongoKitten  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="MongoKitten  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">MongoKitten Docs</a> (72% documented)</p>
        <p class="header-right"><a href="https://github.com/OpenKitten/MongoKitten"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right"><a href="dash-feed://http%3A%2F%2Fopenkitten%2Egithub%2Eio%2FMongoKitten%2FMongoKitten%2Exml"><img src="img/dash.png"/>Install in Dash</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">MongoKitten Reference</a>
        <img id="carat" src="img/carat.png" />
        MongoKitten  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Collection/FindAndModifyOperation.html">– FindAndModifyOperation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Cursor.html">Cursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Database.html">Database</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/GridFS.html">GridFS</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/GridFS/File.html">– File</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SCRAMClient.html">SCRAMClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Server.html">Server</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global Variables.html#/s:v11MongoKitten16DefaultTCPClientPMPS_8MongoTCP_">DefaultTCPClient</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AQT.html">AQT</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/AQT/AQTType.html">– AQTType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/IndexParameter.html">IndexParameter</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/IndexParameter/TextIndexVersion.html">– TextIndexVersion</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MongoAuthenticationError.html">MongoAuthenticationError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MongoError.html">MongoError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SCRAMError.html">SCRAMError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SortOrder.html">SortOrder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Socks.html">Socks</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenop1nFVS_5QueryS0_">!(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2neFTSSP4BSON16ValueConvertible__VS_5Query">!=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2aaFTVS_5QueryS0__S0_">&amp;&amp;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2aeFTVS_5QueryS0__V4BSON8Document">&amp;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi1lFTSSP4BSON16ValueConvertible__VS_5Query">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2leFTSSP4BSON16ValueConvertible__VS_5Query">&lt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2eeFTGSqP4BSON16ValueConvertible__OS0_5Value_Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2eeFTSSP4BSON16ValueConvertible__VS_5Query">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi1gFTSSP4BSON16ValueConvertible__VS_5Query">&gt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2geFTSSP4BSON16ValueConvertible__VS_5Query">&gt;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:F11MongoKittenoi2ooFTVS_5QueryS0__S0_">||(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/MongoTCP.html">MongoTCP</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/DBRef.html">DBRef</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Pipeline.html">Pipeline</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Projection.html">Projection</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Query.html">Query</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/QueryFlags.html">QueryFlags</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Sort.html">Sort</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <a href='#mongokitten' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='mongokitten'>MongoKitten</h1>

<p><a href="https://swift.org"><img src="https://img.shields.io/badge/swift-3.0-orange.svg" alt="Swift 3.0"></a>
<img src="https://img.shields.io/github/license/openkitten/mongokitten.svg" alt="License"></p>

<p>Native MongoDB driver for Swift, written in Swift. This library does not wrap around the mongoc driver. It uses:</p>

<ul>
<li>Our own <a href="https://github.com/OpenKitten/BSON">BSON</a> library, which is also 100% native Swift</li>
<li>Our own <a href="https://github.com/OpenKitten/CryptoKitten">MD5, SHA1, SCRAM and PBKDF2 libraries</a> in 100% Swift (currently included in the package)</li>
<li>Optional support for SSL/TLS using LibreSSL</li>
</ul>
<a href='#documentation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='documentation'>Documentation</h2>

<p>This can be found <a href="http://openkitten.github.io/MongoKitten/docs/">here</a> or you could use our <a href="https://github.com/openkitten/mongokitten/wiki">wiki</a>.</p>

<p>We have our own Dash documentation for MongoKitten which can be found in the top-right corner of the Documentation.</p>
<a href='#enabling-ssl' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='enabling-ssl'>Enabling SSL</h2>

<p>When compiling using SSL you&rsquo;ll need to add another library to your <code>Package.swift</code>.</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="kt">Package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/vapor/tls.git"</span><span class="p">,</span> <span class="nv">majorVersion</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>

<p>Then you&rsquo;ll need to add the compiler flag <code>MongoTLS</code> to your compiler conditions.</p>

<p>Either add <code>MongoTLS</code> to your <code>.xcodeproj</code> under <q>Active Compilation Conditions</q>.
Or by running <code>swift build -Xswiftc -DMongoTLS</code> on the commandline.
For release this would be <code>swift build -c release -Xswiftc -DMongoTLS</code></p>

<p>If you don&rsquo;t prefer this SSL implementation for any reason</p>
<a href='#requirements' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='requirements'>Requirements</h2>

<ul>
<li>A MongoDB server</li>
<li>Some basic knowledge of MongoDB or time to research about MongoDB</li>
<li>Swift 3.0</li>
</ul>
<a href='#running-unit-tests' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='running-unit-tests'>Running Unit Tests</h4>

<p>The unit tests expect a test database. Run the Tools/testprep.sh script to import it.</p>

<p>We don&rsquo;t have complete unit test coverage however MongoKitten has been thoroughly tested in test and production environments.</p>
<a href='#tutorial' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='tutorial'>Tutorial</h1>
<a href='#setup' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='setup'>Setup</h2>

<p>Add <code>MongoKitten</code> to your Package.swift:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"MyApp"</span><span class="p">,</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="kt">Package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/OpenKitten/MongoKitten.git"</span><span class="p">,</span> <span class="nv">majorVersion</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">minor</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<a href='#basic-usage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='basic-usage'>Basic usage</h2>

<p>Import the MongoKitten library:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">MongoKitten</span>
</code></pre>

<p>Connect to your local MongoDB server using an URI:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">server</span><span class="p">:</span> <span class="kt">Server</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Server</span><span class="p">(</span><span class="nv">mongoURL</span><span class="p">:</span> <span class="s">"mongodb://&lt;username&gt;:&lt;password&gt;@localhost:27017"</span><span class="p">,</span> <span class="nv">automatically</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// Unable to connect</span>
    <span class="nf">fatalError</span><span class="p">(</span><span class="s">"MongoDB is not available on the given host and port"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Select a database to use for your application:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">database</span> <span class="o">=</span> <span class="n">server</span><span class="p">[</span><span class="s">"mydatabase"</span><span class="p">]</span>
</code></pre>

<p>And select your collections to use from the database:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">userCollection</span> <span class="o">=</span> <span class="n">database</span><span class="p">[</span><span class="s">"users"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">otherCollection</span> <span class="o">=</span> <span class="n">database</span><span class="p">[</span><span class="s">"otherdata"</span><span class="p">]</span>
</code></pre>
<a href='#creating-documents' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='creating-documents'>Creating Documents</h2>

<p>In <code>MongoKitten</code> we use our own <code>BSON</code> library for working with MongoDB Documents.</p>

<p>You can create a simple user document like this:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">userDocument</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"username"</span><span class="p">:</span> <span class="s">"Joannis"</span><span class="p">,</span>
    <span class="s">"password"</span><span class="p">:</span> <span class="s">"myPassword"</span><span class="p">,</span>
    <span class="s">"age"</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
    <span class="s">"male"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">]</span>
</code></pre>

<p>If you want to embed a variable you&rsquo;ll need to use the <code>~</code> prefix operator.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">niceBoolean</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">let</span> <span class="nv">testDocument</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"example"</span><span class="p">:</span> <span class="s">"data"</span><span class="p">,</span>
    <span class="s">"userDocument"</span><span class="p">:</span> <span class="o">~</span><span class="n">userDocument</span><span class="p">,</span>
    <span class="s">"niceBoolean"</span><span class="p">:</span> <span class="o">~</span><span class="n">niceBoolean</span><span class="p">,</span>
    <span class="s">"embeddedDocument"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"Henk"</span><span class="p">,</span>
        <span class="s">"male"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"age"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s">"pets"</span><span class="p">:</span> <span class="p">[</span><span class="s">"dog"</span><span class="p">,</span> <span class="s">"dog"</span><span class="p">,</span> <span class="s">"cat"</span><span class="p">,</span> <span class="s">"cat"</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre>
<a href='#using-documents' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='using-documents'>Using Documents</h2>

<p>A Document is similar to a Dictionary. A document however has order and thus the position of elements doesn&rsquo;t change unless you tell it to.
A Document is therefore an array and a dictionary at the same time. With the minor difference that a Document can only hold BSON&rsquo;s <code>Value</code>. The problem that arises it when you want to use native types from Swift like a String, Int or another Document (sub-document) and elements in there.
We fixed this with the use of subscripts and getters.</p>

<p>To get a value from the Document you can subscript it like this:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">Value</span> <span class="o">=</span> <span class="n">userDocument</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span>
</code></pre>

<p>Documents always return a value. When the value doesn&rsquo;t exist we&rsquo;ll return <code>Value.nothing</code>.
If you want to get a specific value from the Document like a String we can return an optional String like this:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="n">userDocument</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span><span class="o">.</span><span class="n">stringValue</span>
</code></pre>

<p>However.. for an age you might want a String without receiving <code>nil</code> in a case like this:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="n">userDocument</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span><span class="o">.</span><span class="n">stringValue</span>
</code></pre>

<p>We made this easier by converting it for you:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">userDocument</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
</code></pre>

<p>However.. if the age would normally be <code>.nothing</code> we&rsquo;ll now return an empty string <code>&quot;&quot;</code> instead. So check for that!</p>

<p>Last but not least we&rsquo;ll also want to assign data using a subscript. Because subscript are prone to being ambiguous we had to use enums for assignment.</p>

<p>This would result in this:</p>
<pre class="highlight swift"><code><span class="n">userDocument</span><span class="p">[</span><span class="s">"bool"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"int32"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"int64"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"array"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">array</span><span class="p">([</span><span class="s">"one"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">"three"</span><span class="p">])</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"binary"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">binary</span><span class="p">(</span><span class="nv">subtype</span><span class="p">:</span> <span class="o">.</span><span class="n">generic</span><span class="p">,</span> <span class="nv">data</span><span class="p">:</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">])</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">dateTime</span><span class="p">(</span><span class="kt">NSDate</span><span class="p">())</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"null"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"string"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"objectID"</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="k">try</span> <span class="kt">ObjectId</span><span class="p">(</span><span class="s">"507f1f77bcf86cd799439011"</span><span class="p">))</span>
</code></pre>

<p>Of course variables can still use the <code>~</code> operator:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">trueBool</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">userDocument</span><span class="p">[</span><span class="s">"newBool"</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">trueBool</span>
</code></pre>
<a href='#inserting-documents' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='inserting-documents'>Inserting Documents</h2>

<p>Using the above document you can insert the data in the collection.</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">userDocument</span><span class="p">)</span>
</code></pre>

<p>In the collection&rsquo;s insert method you can also insert a group of Documents: <code>[Document]</code></p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">otherCollection</span><span class="o">.</span><span class="nf">insert</span><span class="p">([</span><span class="n">testDocument</span><span class="p">,</span> <span class="n">testDocument</span><span class="p">,</span> <span class="n">testDocument</span><span class="p">])</span>
</code></pre>
<a href='#finding-data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='finding-data'>Finding data</h2>

<p>To find the Documents in the collection we&rsquo;ll want to use <code>find</code> or <code>findOne</code> on the collection. This returns a <q>cursor</q>.
The <code>find</code> and <code>findOne</code> functions are used on a collection and don&rsquo;t require any parameters.
Adding parameters, however, helps finding the data you need. By providing no arguments we&rsquo;re selecting all data in the collection.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">resultUsers</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">find</span><span class="p">()</span>
</code></pre>

<p>This returns a cursor that you can use to loop over users. <code>MongoKitten</code>&rsquo;s <code>Cursor</code> by default loads 10 Documents at a time from <code>MongoDB</code> which is customizable to a bigger or smaller amount of Documents.</p>

<p>This allows us to provide a smaller delay when looping over data. This also allows the application to remove the cursor halfway through the Documents without downloading Documents that aren&rsquo;t being used.</p>

<p>Looping over the above results is easy:</p>
<pre class="highlight swift"><code><span class="k">for</span> <span class="n">userDocument</span> <span class="k">in</span> <span class="n">resultUsers</span> <span class="p">{</span>
     <span class="nf">print</span><span class="p">(</span><span class="n">userDocument</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">userDocument</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span><span class="o">.</span><span class="n">stringValue</span> <span class="o">==</span> <span class="s">"harriebob"</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">userDocument</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>If you do want all Documents in one array you can use <code>Array()</code>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">otherResultUsers</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">find</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">allUserDocuments</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">otherResultUsers</span><span class="p">)</span>
</code></pre>

<p>But be careful.. a cursor contains the data only once.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">depletedExample</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">find</span><span class="p">()</span>

<span class="c1">// Contains data</span>
<span class="k">let</span> <span class="nv">allUserDocuments</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">depletedExample</span><span class="p">)</span>

<span class="c1">// Doesn't contain data</span>
<span class="k">let</span> <span class="nv">noUserDocuments</span> <span class="o">=</span> <span class="kt">Array</span><span class="p">(</span><span class="n">depletedExample</span><span class="p">)</span>
</code></pre>
<a href='#querybuilder' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='querybuilder'>QueryBuilder</h3>

<p>We also have a query builder which can be easily used to create filters when searching for Documents.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">q</span><span class="p">:</span> <span class="kt">Query</span> <span class="o">=</span> <span class="s">"username"</span> <span class="o">==</span> <span class="s">"Joannis"</span> <span class="o">&amp;&amp;</span> <span class="s">"age"</span> <span class="o">&gt;</span> <span class="mi">18</span>

<span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="n">q</span><span class="p">)</span>
</code></pre>

<p>Or simpler:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">newResult</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="s">"username"</span> <span class="o">==</span> <span class="s">"Joannis"</span> <span class="o">&amp;&amp;</span> <span class="s">"age"</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">)</span>
</code></pre>

<p>This comes in handy when looping over data:</p>
<pre class="highlight swift"><code><span class="k">for</span> <span class="n">user</span> <span class="k">in</span> <span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="s">"male"</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<a href='#updating-data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='updating-data'>Updating data</h2>

<p>Updating data is simple too. There is a <code>multiple</code> argument for people who update more than one document at a time. This example only updates the first match:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="p">[</span><span class="s">"username"</span><span class="p">:</span> <span class="s">"Joannis"</span><span class="p">],</span> <span class="nv">to</span><span class="p">:</span> <span class="p">[</span><span class="s">"username"</span><span class="p">:</span> <span class="s">"Robbert"</span><span class="p">])</span>
</code></pre>
<a href='#deleting-data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='deleting-data'>Deleting data</h2>

<p>Deleting is possible using a document and a query</p>
<pre class="highlight swift"><code><span class="c1">// Delete using a document</span>
<span class="k">try</span> <span class="n">userCollection</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="p">[</span><span class="s">"username"</span><span class="p">:</span> <span class="s">"Robbert"</span><span class="p">])</span>
</code></pre>
<a href='#gridfs' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='gridfs'>GridFS</h2>
<pre class="highlight swift"><code><span class="c1">// Make a GridFS Collection within the database 'mydatabase'</span>
<span class="k">let</span> <span class="nv">gridFS</span> <span class="o">=</span> <span class="kt">GridFS</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">server</span><span class="p">[</span><span class="s">"mydatabase"</span><span class="p">])</span>

<span class="c1">// Find all bytes corresponding to this image</span>
<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="kt">NSData</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="s">"./myimage.jpg"</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// Store the file in GridFS with maximum 10000 bytes per chunk (255000 is the recommended default) and doesn't need to be set</span>
<span class="c1">// Store the ObjectID corresponding to the file in a constant variable</span>
<span class="k">let</span> <span class="nv">objectID</span> <span class="o">=</span> <span class="k">try</span> <span class="n">gridFS</span><span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="n">named</span> <span class="s">"myimage.jpg"</span><span class="p">,</span> <span class="nv">withType</span><span class="p">:</span> <span class="s">"image/jpeg"</span><span class="p">,</span> <span class="nv">inChunksOf</span><span class="p">:</span> <span class="mi">10000</span><span class="p">)</span>

<span class="c1">// Retrieve the file from GridFS</span>
<span class="k">let</span> <span class="nv">file</span> <span class="o">=</span> <span class="k">try</span> <span class="n">gridFS</span><span class="o">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nv">byID</span><span class="p">:</span> <span class="n">objectID</span><span class="p">)</span>

<span class="c1">// Get the bytes we need</span>
<span class="k">let</span> <span class="nv">myImageData</span><span class="p">:</span> <span class="p">[</span><span class="kt">Byte</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">!.</span><span class="nf">read</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="mi">1234</span><span class="p">)</span>
</code></pre>
<a href='#gridfs-example-scenario' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='gridfs-example-scenario'>GridFS example scenario</h3>

<p>Imagine running a video streaming site. One of your users uploads a video. This will be stored in GridFS within 255000-byte chunks.</p>

<p>Now one user starts watching the video. You&rsquo;ll load the video chunk-by-chunk without keeping all of the video&rsquo;s buffer in memory.</p>

<p>The user quits the video about 40% through the video. Let&rsquo;s say chunk 58 of 144 of your video. Now you&rsquo;ll want to start continuing the video where it left off without receving all the unnecessary chunks.</p>
<a href='#license' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='license'>License</h2>

<p>MongoKitten is licensed under the MIT license.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2016 <a class="link" href="" target="_blank" rel="external">Robbert Brandsma &amp; Joannis Orlandos</a>. All rights reserved. (Last updated: 2016-11-03)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.2</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
